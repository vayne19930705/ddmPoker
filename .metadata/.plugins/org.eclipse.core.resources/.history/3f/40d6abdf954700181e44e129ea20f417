package core.game.poker_nn;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import com.sun.org.apache.xpath.internal.functions.FuncFalse;

import business.global.log.BaseLog;
import business.global.poker.Poker;
import business.global.poker.PokerManager;

public class NNCardUtil extends BaseLog{
	
	//特殊牌名-牌面值("1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "s", "w")_maxStringValueCardID
	
	//各种牌型对应牌型名字符串:
	
	//五小牛 s_x_n
	public String CardName_FiveLittleNiu = "s_x_n";
	//四炸
	public String CardName_BoomNiu = "s_t_n";
	//五花牛
	public String CardName_FlowerNiu = "s_h_n";
	//牛牛
	public String CardName_NiuNiu = "c_a_n";
	//牛9-牛1 c_9_n- c_1_n
	public String CardName_NiuPoint = "c_%s_n";
	//无牛
	public String CardName_NotNiu = "c_0_n";
	
	private static NNCardUtil instance = new NNCardUtil();
	
	public PokerManager pokerManager = null;

	protected ArrayList<Integer> allJokerCardIDList = new ArrayList<>(); //所有鬼牌
	
	public static NNCardUtil getInstance(){
		return instance;
	}
	
	public NNCardUtil(){
		this.init();
	}
	
	public String getLogString(){
		return "[NNCardUtil]\t";
	}
	
	public void init(){
		this.pokerManager = PokerManager.getInstance();
		
		//初始化鬼牌
		ArrayList<Integer> jokerCardIDList = pokerManager.getJokerCardIDList();
		
		this.allJokerCardIDList.addAll(jokerCardIDList);
	}
	
	//-------------入口---------------
	//外部调用入口
	public void onStart(){
		
		//玩家手牌5张
		List<Integer> handCardIDList = new ArrayList<>(Arrays.asList(110,111,112,113,213));
		
		//TODO:获取手牌是牛几
		NNPointCardInfo cardInfo = this.getCardInfo(handCardIDList, this.allJokerCardIDList);
		
		this.info(":{} 结果:{},{}", handCardIDList, cardInfo.cardName, cardInfo.endCardIDList);
	}
	
	
	//获取手牌结果
	public NNPointCardInfo getCardInfo(List<Integer> cardIDList, List<Integer> jokerIDList){
		
		NNPointCardInfo cardInfo = new NNPointCardInfo();
		
		if(cardIDList.size() != 5){
			this.error("getCardInfo cardIDList:{} error", cardIDList);
			return cardInfo;
		}
		//拷贝一份
		List<Integer> allCardIDList = new ArrayList<>(cardIDList);
		allCardIDList.sort((x,y)->{return y-x;});
		
		List<Poker> pokerList = this.pokerManager.getPokerList(allCardIDList);
		
		
		//是否是5小牛
		cardInfo = this.s1_FiveLittleNiu(pokerList, allCardIDList, jokerIDList);
		if(cardInfo != null){
			return cardInfo;
		}
		
		//是否是 四炸
		cardInfo = this.s2_BoomNiu(pokerList, allCardIDList, jokerIDList);
		if(cardInfo != null){
			return cardInfo;
		}
		
		
		//五花牛
		cardInfo = this.s3_FlowerNiu(pokerList, allCardIDList, jokerIDList);
		if(cardInfo != null){
			return cardInfo;
		}
		
		//获取牌型可能的点数
		cardInfo = this.c1_point(pokerList, allCardIDList, jokerIDList);
		
		return cardInfo;
	}
	
	
	
	
	
	//五小牛
	public NNPointCardInfo s1_FiveLittleNiu(List<Poker> cards, List<Integer> allCardIDList, List<Integer> jokerIDList){
		
		NNPointCardInfo cardInfo = new NNPointCardInfo();
		int sumPoint = 0;
		Boolean isFiveLittleNiu = false;
		
		for(Poker poker : cards)
		{
			if( poker.value < 5)			//牌面值小于5，计入总和，跳过本次循环
			{
				sumPoint += poker.value;
				continue;
			}else if( poker.value >13 )			//牌面值>13，判断是否是鬼牌
			{
				if( jokerIDList.contains(poker.id))
				{
					sumPoint++;			//此时，默认鬼牌牌面值为1
					break;
				}
				
			}else //牌面值大于5，且不是鬼牌，判定无法构成五小牛,跳出循环
			{
				isFiveLittleNiu = false;
				break;
			}
		}
		
		if( sumPoint >10 )
			isFiveLittleNiu = false ;
		else
			isFiveLittleNiu = true ;
		if( isFiveLittleNiu )			//如果是五小牛，返回牌的类型信息 & 排序后的ID信息
		{
			cardInfo.cardName = CardName_FiveLittleNiu ;
			cardInfo.endCardIDList.addAll(allCardIDList);
			cardInfo.endCardIDList.sort(( x , y ) ->
			{
				if( jokerIDList.contains(x) && jokerIDList.contains(y) )			//两张鬼牌
				{
					return y-x;
				}					
				else if( jokerIDList.contains(x) || jokerIDList.contains(y) )			//一张鬼牌
				{
					return y-x;
				}else if( x%100 == y%100 )			//牌面值相等
				{
					return y-x;
				}else			//牌面值不等
				{
					return y%100 - x%100;
				}
				
			});
		}else //不是五小牛，返回null
		{
			cardInfo = null;
		}
		
		return null;
	}
	
	//四炸
	public NNPointCardInfo s2_BoomNiu(List<Poker> cards, List<Integer> allCardIDList, List<Integer> jokerIDList){
		
		NNPointCardInfo cardInfo = new NNPointCardInfo();
		Boolean isBoomNiu = false;
		int sumSame = 0;
		int sumJoker = 0;
		
		for( Poker poker : cards) //统计鬼牌数
		{
				if( jokerIDList.contains(poker.id))
				{
					sumJoker++;  //鬼牌数+1
					break;
				}
		}
		
		//判断是否是炸弹牛
		for( int i = 0; i < cards.size()-2; i++ )
		{
			if( jokerIDList.contains(cards.get(i).id))			//如果是鬼牌，跳过
				continue;
			for( int j = i+1; j < cards.size()-1; j++)			//否则，遍历后续牌，检查相同牌的数量
			{
				if( jokerIDList.contains(cards.get(i).id))			//如果是鬼牌，跳过
				{
					continue;
				}	
				if( cards.get(i).id == cards.get(j).id )
				{
					sumSame++;
				}else
				{
					
				}
			}
		}
		return cardInfo;
		
	}
	
	//五花牛
	public NNPointCardInfo s3_FlowerNiu(List<Poker> cards, List<Integer> allCardIDList, List<Integer> jokerIDList){
		
		
		NNPointCardInfo cardInfo = new NNPointCardInfo();

		return cardInfo;
	}
	
	
	//获取牌型可能的点数
	public NNPointCardInfo c1_point(List<Poker> cards,  List<Integer> allCardIDList, List<Integer> jokerIDList){

		NNPointCardInfo cardInfo = new NNPointCardInfo();

		return cardInfo;
		
	}
	
}
